\documentclass{article}
\input{/Users/milav/Code/milav-next/latex-templates/gtu-solutions/preamble.tex}
\input{/Users/milav/Code/milav-next/latex-templates/gtu-solutions/gujarati-boxes.tex}
\input{/Users/milav/Code/milav-next/latex-templates/gtu-solutions/commands.tex}

\title{Embedded System \& Microcontroller Application (4351102) - Summer 2025 Solution Gujarati}
\date{May 12, 2025}

\begin{document}
\maketitle

\questionmarks{1(અ)}{3}{ATmega32 ની લાક્ષણિકતાઓ જણાવો.}

\begin{solutionbox}
\textbf{ATmega32 લાક્ષણિકતાઓ:}

\begin{answertable}{ATmega32 લાક્ષણિકતાઓ}
\begin{tabulary}{\linewidth}{|L|L|}
\hline
\textbf{લાક્ષણિકતા} & \textbf{વર્ણન} \\ \hline
\keyword{Flash Memory} & 32KB programmable memory \\ \hline
\keyword{SRAM} & 2KB internal SRAM \\ \hline
\keyword{EEPROM} & 1KB non-volatile data storage \\ \hline
\keyword{I/O Pins} & 32 programmable I/O lines \\ \hline
\keyword{Timers} & 3 flexible timer/counters \\ \hline
\keyword{ADC} & 10-bit 8-channel ADC \\ \hline
\end{tabulary}
\end{answertable}

\keyword{વધારાની વિશેષતાઓ:}
\begin{itemize}
    \item \keyword{Operating Voltage}: 2.7V થી 5.5V રેંજ
    \item \keyword{Clock Speed}: 16 MHz સુધી ની ઓપરેશન
    \item \keyword{Communication}: USART, SPI, I2C interfaces
\end{itemize}
\end{solutionbox}

\begin{mnemonicbox}
\mnemonic{Fast SRAM Enjoys Input Timers And Communication}
\end{mnemonicbox}

\questionmarks{1(બ)}{4}{માઈક્રોકંટ્રોલર પસંદ કરવા માટેના માપદંડો લખો.}

\begin{solutionbox}
\textbf{પસંદગીના માપદંડો:}

\begin{answertable}{પસંદગીના માપદંડો}
\begin{tabulary}{\linewidth}{|L|L|}
\hline
\textbf{માપદંડ} & \textbf{વિચારણા} \\ \hline
\keyword{Processing Speed} & Clock frequency આવશ્યકતાઓ \\ \hline
\keyword{Memory Size} & Program અને data storage જરૂરિયાત \\ \hline
\keyword{I/O Requirements} & જરૂરી pins ની સંખ્યા \\ \hline
\keyword{Power Consumption} & Battery life વિચારણાઓ \\ \hline
\keyword{Cost} & Budget મર્યાદાઓ \\ \hline
\keyword{Development Tools} & Compiler અને debugger ઉપલબ્ધતા \\ \hline
\end{tabulary}
\end{answertable}

\keyword{સિસ્ટમ વિચારણાઓ:}
\begin{itemize}
    \item \keyword{Application Type}: Real-time vs general purpose
    \item \keyword{Communication Needs}: Serial, parallel, wireless protocols
    \item \keyword{Package Size}: Final product માં space constraints
\end{itemize}
\end{solutionbox}

\begin{mnemonicbox}
\mnemonic{Processing Memory I/O Power Cost Development Application Communication Package}
\end{mnemonicbox}

\questionmarks{1(ક)}{7}{એમ્બેડેડ સિસ્ટમનો સામાન્ય બ્લોક ડાયાગ્રામ દોરો અને સમજાવો.}

\begin{solutionbox}
\textbf{સામાન્ય બ્લોક ડાયાગ્રામ:}

\begin{answerdiagram}{Embedded System Block Diagram}
\begin{tikzpicture}[auto, node distance=2cm]
    \node [gtu block] (cpu) {Processor/\\Microcontroller};
    \node [gtu block, left=of cpu] (input) {Input Devices};
    \node [gtu block, right=of cpu] (output) {Output Devices};
    \node [gtu block, above=of cpu] (mem) {Memory};
    \node [gtu block, below=of cpu] (comm) {Communication\\Interface};
    \node [gtu block, below left=1.5cm of cpu] (power) {Power Supply};
    \node [gtu block, below right=1.5cm of cpu] (clock) {Clock/Timer};

    \path [gtu arrow] (input) -- (cpu);
    \path [gtu arrow] (cpu) -- (output);
    \path [gtu arrow] (cpu) edge[bend right] (mem);
    \path [gtu arrow] (mem) edge[bend right] (cpu);
    \path [gtu arrow] (cpu) edge[bend right] (comm);
    \path [gtu arrow] (comm) edge[bend right] (cpu);
    \path [gtu arrow] (power) -- (cpu);
    \path [gtu arrow] (clock) -- (cpu);
\end{tikzpicture}
\end{answerdiagram}

\keyword{બ્લોક કાર્યો:}
\begin{itemize}
    \item \keyword{Processor}: Instructions execute કરતું central processing unit
    \item \keyword{Memory}: Program code અને data temporary store કરે છે
    \item \keyword{Input Devices}: Sensors, switches જે system input આપે છે
    \item \keyword{Output Devices}: Actuators, displays જે results બતાવે છે
    \item \keyword{Communication}: External device connectivity માટે interfaces
    \item \keyword{Power Supply}: બધા components ને stable voltage પૂરું પાડે છે
    \item \keyword{Clock/Timer}: System operations અને timing synchronize કરે છે
\end{itemize}
\end{solutionbox}

\begin{mnemonicbox}
\mnemonic{Processors Memory Input Output Communication Power Clock}
\end{mnemonicbox}

\orquestionmarks{1(ક)}{7}{રીયલ ટાઈમ ઓપરેટિંગ સિસ્ટમને વ્યાખ્યાયિત કરો અને તેની લાક્ષણિકતાઓ સમજાવો.}

\begin{solutionbox}
\textbf{Real Time Operating System (RTOS):} કડક time constraints માં data અને events process કરવા માટે design કરેલું operating system.

\begin{answertable}{RTOS લાક્ષણિકતાઓ}
\begin{tabulary}{\linewidth}{|L|L|}
\hline
\textbf{લાક્ષણિકતા} & \textbf{વર્ણન} \\ \hline
\keyword{Deterministic} & Predictable response times \\ \hline
\keyword{Preemptive} & Higher priority tasks interrupt lower ones \\ \hline
\keyword{Multitasking} & Multiple tasks concurrently run થાય છે \\ \hline
\keyword{Fast Context Switch} & Quick task switching capability \\ \hline
\keyword{Priority Scheduling} & Tasks priority પર આધારે execute થાય છે \\ \hline
\keyword{Interrupt Handling} & Efficient interrupt processing \\ \hline
\end{tabulary}
\end{answertable}

\keyword{મુખ્ય વિભાવનાઓ:}
\begin{itemize}
    \item \keyword{Hard Real-time}: Deadline miss થવાથી system failure થાય છે
    \item \keyword{Soft Real-time}: Deadline miss થવાથી performance degraded થાય છે
    \item \keyword{Time Constraints}: Operations deadline માં complete થવા જોઈએ
\end{itemize}
\end{solutionbox}

\begin{mnemonicbox}
\mnemonic{Deterministic Preemptive Multitasking Fast Priority Interrupt}
\end{mnemonicbox}

\questionmarks{2(અ)}{3}{ATmega32 નો પીન ડાયાગ્રામ દોરો.}

\begin{solutionbox}
\textbf{ATmega32 Pin Configuration:}

\begin{center}
\begin{tikzpicture}[
    pin/.style={draw, rectangle, minimum width=2.5cm, minimum height=0.5cm, font=\small},
    ic/.style={draw, rectangle, minimum width=4cm, minimum height=11cm, fill=gray!10}
]
    % IC Body
    \node [ic] (body) {};
    \node [anchor=north, font=\large\bfseries] at (body.north) {ATmega32};
    \node [anchor=north] at (body.north) [yshift=-0.5cm] {\tiny (DIP-40)};

    % Left Pins
    \foreach \i/\label in {1/PB0, 2/PB1, 3/PB2, 4/PB3, 5/PB4, 6/PB5, 7/PB6, 8/PB7, 9/RESET, 10/VCC, 11/GND, 12/XTAL2, 13/XTAL1, 14/PD0, 15/PD1, 16/PD2, 17/PD3, 18/PD4, 19/PD5, 20/PD6} {
        \node [anchor=west, font=\tiny] at ([yshift=-0.5cm-\i*0.5cm]body.north west) {\i\ \label};
        \draw ([yshift=-0.5cm-\i*0.5cm]body.north west) -- +(-0.2,0);
    }

    % Right Pins
    \foreach \i/\label in {40/PA0, 39/PA1, 38/PA2, 37/PA3, 36/PA4, 35/PA5, 34/PA6, 33/PA7, 32/AREF, 31/GND, 30/AVCC, 29/PC7, 28/PC6, 27/PC5, 26/PC4, 25/PC3, 24/PC2, 23/PC1, 22/PC0, 21/PD7} {
        \pgfmathsetmacro{\ypos}{41-\i}
        \node [anchor=east, font=\tiny] at ([yshift=-0.5cm-\ypos*0.5cm]body.north east) {\label\ \i};
        \draw ([yshift=-0.5cm-\ypos*0.5cm]body.north east) -- +(0.2,0);
    }
\end{tikzpicture}
\end{center}
\end{solutionbox}

\begin{mnemonicbox}
\mnemonic{Port B A Reset Vcc Ground Crystal Port D C}
\end{mnemonicbox}

\questionmarks{2(બ)}{4}{ATmega32 નો સ્ટેટસ રજિસ્ટર સમજાવો.}

\begin{solutionbox}
\keyword{Status Register (SREG):}

\begin{answertable}{SREG Bit Configuration}
\begin{tabulary}{\linewidth}{|L|L|L|}
\hline
\textbf{Bit} & \textbf{Name} & \textbf{Function} \\ \hline
\keyword{Bit 7} & I & Global Interrupt Enable \\ \hline
\keyword{Bit 6} & T & Bit Copy Storage \\ \hline
\keyword{Bit 5} & H & Half Carry Flag \\ \hline
\keyword{Bit 4} & S & Sign Bit \\ \hline
\keyword{Bit 3} & V & Overflow Flag \\ \hline
\keyword{Bit 2} & N & Negative Flag \\ \hline
\keyword{Bit 1} & Z & Zero Flag \\ \hline
\keyword{Bit 0} & C & Carry Flag \\ \hline
\end{tabulary}
\end{answertable}

\keyword{કાર્યો:}
\begin{itemize}
    \item \keyword{Flags Update}: ALU operations દ્વારા automatically set/clear થાય છે
    \item \keyword{Conditional Branching}: Program flow control માટે વપરાય છે
    \item \keyword{Interrupt Control}: I-bit બધા interrupts ને enable/disable કરે છે
\end{itemize}
\end{solutionbox}

\begin{mnemonicbox}
\mnemonic{I Think Half Sign Overflow Negative Zero Carry}
\end{mnemonicbox}

\questionmarks{2(ક)}{7}{ATmega32 ની ડેટા મેમરી વિગતવાર સમજાવો.}

\begin{solutionbox}
\textbf{Data Memory Organization:}

\begin{answerdiagram}{Data Memory Space}
\begin{tikzpicture}[auto, node distance=1.5cm]
    \node [gtu block, minimum width=4cm] (sram) {Data Memory Space};
    \node [gtu block, below=of sram] (gpr) {General Purpose Registers\\R0-R31 (0x00-0x1F)};
    \node [gtu block, below=of gpr] (io) {I/O Memory\\(0x20-0x5F)};
    \node [gtu block, below=of io] (extio) {Extended I/O\\(0x60-0xFF)};
    \node [gtu block, below=of extio] (ram) {Internal SRAM\\(0x100-0x8FF)};

    \path [gtu arrow] (sram) -- (gpr);
    \path [gtu arrow] (sram) edge[bend right] (io);
    \path [gtu arrow] (sram) edge[bend right] (extio);
    \path [gtu arrow] (sram) edge[bend right] (ram);
\end{tikzpicture}
\end{answerdiagram}

\keyword{મેમરી વિભાગો:}
\begin{itemize}
    \item \keyword{General Purpose Registers}: Data operations માટે 32 registers (R0-R31)
    \item \keyword{I/O Memory}: Peripheral control registers (Port, Timer, UART) માટે 64 registers
    \item \keyword{Extended I/O}: Additional peripheral registers અને stack pointer
    \item \keyword{Internal SRAM}: Variables અને stack માટે 2KB volatile memory
    \item \keyword{Stack}: High memory addresses થી low addresses તરફ downward grows થાય છે
\end{itemize}
\end{solutionbox}

\begin{mnemonicbox}
\mnemonic{General I/O Extended SRAM Address Stack}
\end{mnemonicbox}

\orquestionmarks{2(અ)}{3}{DDRx, PINx અને PORTx રજિસ્ટરના કાર્યો લખો.}

\begin{solutionbox}
\textbf{I/O Port Registers:}

\begin{answertable}{I/O Registers}
\begin{tabulary}{\linewidth}{|L|L|}
\hline
\textbf{Register} & \textbf{Function} \\ \hline
\keyword{DDRx} & Data Direction Register - pin direction configure કરે છે \\ \hline
\keyword{PINx} & Pin Input Register - current pin logical state read કરે છે \\ \hline
\keyword{PORTx} & Port Output Register - data/pull-up control write કરે છે \\ \hline
\end{tabulary}
\end{answertable}

\keyword{ઓપરેશન્સ:}
\begin{itemize}
    \item \keyword{DDRx}: Output માટે 1, Input માટે 0 set કરો
    \item \keyword{PINx}: Physical pin voltage level access કરે છે
    \item \keyword{PORTx}: DDRx=1 હોય ત્યારે High/Low drive કરે છે. DDRx=0 હોય ત્યારે internal Pull-up enable કરે છે
\end{itemize}
\end{solutionbox}

\begin{mnemonicbox}
\mnemonic{Direction Input Output}
\end{mnemonicbox}

\orquestionmarks{2(બ)}{4}{AVR માં EEPROM સાથે સંકળાયેલા વિવિધ I/O રજિસ્ટરો સમજાવો.}

\begin{solutionbox}
\keyword{EEPROM Registers:}

\begin{answertable}{EEPROM Registers}
\begin{tabulary}{\linewidth}{|L|L|}
\hline
\textbf{Register} & \textbf{Function} \\ \hline
\keyword{EEAR} & EEPROM Address Register (High/Low bytes) \\ \hline
\keyword{EEDR} & EEPROM Data Register \\ \hline
\keyword{EECR} & EEPROM Control Register \\ \hline
\end{tabulary}
\end{answertable}

\keyword{EECR Control Bits:}
\begin{itemize}
    \item \keyword{EERIE}: EEPROM Ready Interrupt Enable
    \item \keyword{EEMWE}: EEPROM Master Write Enable
    \item \keyword{EEWE}: EEPROM Write Enable (Strobe to write)
    \item \keyword{EERE}: EEPROM Read Enable
\end{itemize}

\keyword{પ્રક્રિયા}: Write માટે, કોઈ write progress માં નથી તેની ખાતરી કરો, address અને data set કરો, EEMWE set કરો, પછી 4 clock cycles માં EEWE set કરો.
\end{solutionbox}

\begin{mnemonicbox}
\mnemonic{Address Data Control Ready Master Write Read}
\end{mnemonicbox}

\orquestionmarks{2(ક)}{7}{ક્લોક સોર્સને AVR સાથે જોડવાની વિવિધ રીતો સમજાવો.}

\begin{solutionbox}
\textbf{Clock Source Options:}

\begin{answerdiagram}{Clock Sources}
\begin{tikzpicture}[auto, node distance=2cm]
    \node [gtu block] (avr) {AVR Microcontroller};
    \node [gtu block, above left=of avr] (xtal) {External Crystal\\(1-16 MHz)};
    \node [gtu block, below left=of avr] (extrc) {External RC\\Oscillator};
    \node [gtu block, above right=of avr] (intrc) {Internal RC\\(1, 2, 4, 8 MHz)};
    \node [gtu block, below right=of avr] (extclk) {External Clock\\Signal};

    \draw [gtu arrow] (xtal) -- (avr);
    \draw [gtu arrow] (extrc) -- (avr);
    \draw [gtu arrow] (intrc) -- (avr);
    \draw [gtu arrow] (extclk) -- (avr);
\end{tikzpicture}
\end{answerdiagram}

\begin{answertable}{Clock Source Types}
\begin{tabulary}{\linewidth}{|L|L|}
\hline
\textbf{Source} & \textbf{વર્ણન} \\ \hline
\keyword{External Crystal} & XTAL1/XTAL2 સાથે જોડાયેલ High precision quartz crystal. Capacitor જરૂરી. \\ \hline
\keyword{External RC} & Resistor-Capacitor circuit. ઓછી કિંમત, ઓછી ચોકસાઇ. \\ \hline
\keyword{Internal RC} & Built-in oscillator. કોઈ external components નહીં. 1MHz default, 8MHz સુધી. \\ \hline
\keyword{External Clock} & External logic signal થી XTAL1 drive કરો. \\ \hline
\end{tabulary}
\end{answertable}

\keyword{Configuration:}
\begin{itemize}
    \item \keyword{Fuse Bits}: CKSEL3:0 અને SUT1:0 active clock source અને startup time નક્કી કરે છે
    \item \keyword{ઉપયોગ}: Timing-critical (UART) માટે Crystal, cost/power saving માટે Internal RC
\end{itemize}
\end{solutionbox}

\begin{mnemonicbox}
\mnemonic{Crystal RC Internal External Fuse Startup Frequency Components}
\end{mnemonicbox}

\questionmarks{3(અ)}{3}{Timer 1 સાથે સંકળાયેલા રજિસ્ટરોનું કાર્ય લખો.}

\begin{solutionbox}
\textbf{Timer 1 Registers (16-bit):}

\begin{answertable}{Timer 1 Registers}
\begin{tabulary}{\linewidth}{|L|L|}
\hline
\textbf{Register} & \textbf{Function} \\ \hline
\keyword{TCNT1} & Timer/Counter Register - Holds current count value (16-bit) \\ \hline
\keyword{TCCR1A/B} & Control Registers - Sets mode, prescaler, compare output \\ \hline
\keyword{ICR1} & Input Capture Register - Captures TCNT1 value on event \\ \hline
\keyword{OCR1A/B} & Output Compare Registers - Values to compare with TCNT1 \\ \hline
\keyword{TIMSK} & Interrupt Mask - Enables Overflow/Compare/Capture interrupts \\ \hline
\keyword{TIFR} & Interrupt Flag - Indicates pending interrupts \\ \hline
\end{tabulary}
\end{answertable}
\end{solutionbox}

\begin{mnemonicbox}
\mnemonic{Timer Control Input Output Mask Flag}
\end{mnemonicbox}

\questionmarks{3(બ)}{4}{Timer 0 ને સામાન્ય મોડમાં પ્રોગ્રામ કરવાના મુદ્દાઓ લખો.}

\begin{solutionbox}
\textbf{Normal Mode માટે Programming Steps:}

\begin{enumerate}
    \item \keyword{Configure Mode}: Normal Mode select કરવા TCCR0 માં write કરો (WGM01:0 = 00)
    \item \keyword{Load Initial Value}: TCNT0 માં starting count write કરો
    \item \keyword{Interrupts}: જો interrupts વાપરતા હોય, TIMSK માં TOIE0 set કરો અને global interrupts enable કરો (sei)
    \item \keyword{Start Timer}: TCCR0 માં prescaler bits (CS02:0) set કરો
    \item \keyword{Monitor/Handle}: TIFR માં TOV0 flag માટે wait કરો (polling) અથવા ISR માં handle કરો
\end{enumerate}

\begin{lstlisting}[language=C]
TCCR0 = 0x00;        // Stop timer
TCNT0 = 0x00;        // Clear count
TCCR0 = 0x01;        // Start: Normal mode, No prescaler
while(!(TIFR & 1));  // Wait for overflow
TIFR = 0x01;         // Clear flag
\end{lstlisting}
\end{solutionbox}

\begin{mnemonicbox}
\mnemonic{Set Select Load Enable Start}
\end{mnemonicbox}

\questionmarks{3(ક)}{7}{ડેટા બાઈટોને સીરીયલી રીસીવ કરાવવા અને તેમને PORTA પર મૂકવા માટેનો C પ્રોગ્રામ લખો. બાઉડ રેટ 9600, 8-બીટ, અને 1-બીટ સેટ કરો.}

\begin{solutionbox}
\textbf{પ્રોગ્રામ:}

\begin{lstlisting}[language=C]
#include <avr/io.h>

void USART_Init() {
    // Set baud rate to 9600 (assuming 8MHz clock)
    UBRRH = 0x00;
    UBRRL = 51;
    
    // Enable receiver
    UCSRB = (1<<RXEN);
    
    // Set frame format: 8 data, 1 stop bit
    // URSEL must be 1 to write to UCSRC
    UCSRC = (1<<URSEL) | (3<<UCSZ0);
}

unsigned char USART_Receive() {
    // Wait for data to be received (RXC flag)
    while(!(UCSRA & (1<<RXC)));
    // Get and return received data from buffer
    return UDR;
}

int main() {
    DDRA = 0xFF;        // Configure PORTA as output
    USART_Init();       // Initialize USART
    
    while(1) {
        PORTA = USART_Receive();  // Receive and display on Port A
    }
    return 0;
}
\end{lstlisting}
\end{solutionbox}

\begin{mnemonicbox}
\mnemonic{Initialize Receive Display Loop}
\end{mnemonicbox}

\orquestionmarks{3(અ)}{3}{AVR માં સીરીયલ કોમ્યુનિકેશન સાથે સંકળાયેલા રજિસ્ટરોના કાર્યો લખો.}

\begin{solutionbox}
\textbf{USART Registers:}

\begin{answertable}{USART Registers}
\begin{tabulary}{\linewidth}{|L|L|}
\hline
\textbf{Register} & \textbf{Function} \\ \hline
\keyword{UDR} & USART Data Register - Buffer for Tx/Rx data \\ \hline
\keyword{UCSRA} & Control/Status A - Flags (RXC, TXC, UDRE), error bits \\ \hline
\keyword{UCSRB} & Control/Status B - Enable Rx/Tx, Interrupts (RXCIE), 9th bit \\ \hline
\keyword{UCSRC} & Control/Status C - Frame format (Data bits, Parity, Stop bits) \\ \hline
\keyword{UBRR} & Baud Rate Register - Sets communication speed \\ \hline
\end{tabulary}
\end{answertable}
\end{solutionbox}

\begin{mnemonicbox}
\mnemonic{Data Control Status Baud}
\end{mnemonicbox}

\orquestionmarks{3(બ)}{4}{ડેટા સીરીયલી ટ્રાન્સફર કરવા માટે AVR ને પ્રોગ્રામ કરવાના મુદ્દાઓની ચર્ચા કરો.}

\begin{solutionbox}
\textbf{Serial Transmission Steps:}

\begin{enumerate}
    \item \keyword{Baud Rate}: Calculate અને UBRRH/Low registers માં load કરો
    \item \keyword{Frame Format}: UCSRC માં data bits, parity, અને stop bits set કરો (e.g., 8N1)
    \item \keyword{Enable Tx}: Transmitter enable કરવા UCSRB માં TXEN bit set કરો
    \item \keyword{Wait for Buffer}: UDR empty છે તેની ખાતરી કરવા UCSRA માં UDRE flag monitor કરો
    \item \keyword{Send Data}: Transmission શરૂ કરવા UDR register માં byte write કરો
\end{enumerate}

\begin{lstlisting}[language=C]
void USART_Transmit(unsigned char data) {
    // Wait for empty transmit buffer
    while(!(UCSRA & (1<<UDRE)));
    // Put data into buffer, sends the data
    UDR = data;
}
\end{lstlisting}
\end{solutionbox}

\begin{mnemonicbox}
\mnemonic{Baud Enable Format Wait Load}
\end{mnemonicbox}

\orquestionmarks{3(ક)}{7}{દર 2 મિલિસેકન્ડે માત્ર PORTB.4 બીટને સતત ટોગલ કરવા માટેનો C પ્રોગ્રામ લખો. Delay જનરેટ કરવા timer 1ને પ્રીસ્કેલર વગર નોર્મલ મોડમાં ઉપયોગ કરો. XTAL=8MHz ધારો.}

\begin{solutionbox}
\textbf{Timer 1 Delay ગણતરી:}
\begin{itemize}
    \item \keyword{Target Delay}: 2 ms
    \item \keyword{Frequency}: 8 MHz
    \item \keyword{Machine Cycle}: $1/8\text{MHz} = 0.125\mu\text{s}$
    \item \keyword{Counts Required}: $2\text{ms} / 0.125\mu\text{s} = 16000$ counts
    \item \keyword{Timer Start Value}: $65536 - 16000 = 49536$ (0xC180)
\end{itemize}

\textbf{પ્રોગ્રામ:}

\begin{lstlisting}[language=C]
#include <avr/io.h>
#include <avr/interrupt.h>

// ISR for Timer1 Overflow
ISR(TIMER1_OVF_vect) {
    // Toggle PORTB.4
    PORTB ^= (1<<4);
    
    // Reload Timer for 2ms
    TCNT1 = 49536; 
}

int main() {
    // Set PORTB.4 as output
    DDRB |= (1<<4);
    
    // Initialize Timer1
    // Normal Mode (WGM13:0 = 0000)
    TCCR1A = 0x00;
    
    // Start Timer with No Prescaler (CS12:0 = 001)
    TCCR1B = (1<<CS10);
    
    // Load initial count
    TCNT1 = 49536;
    
    // Enable Timer1 Overflow Interrupt
    TIMSK |= (1<<TOIE1);
    
    // Enable Global Interrupts
    sei();
    
    while(1) {
        // Main loop does nothing, ISR handles toggling
    }
    return 0;
}
\end{lstlisting}
\end{solutionbox}

\begin{mnemonicbox}
\mnemonic{Configure Timer Calculate Enable Loop}
\end{mnemonicbox}

\questionmarks{4(a)}{3}{ULN2803 નો ATmega32 સાથે ઇન્ટરફેસિંગ ડાયાગ્રામ દોરો.}

\begin{solutionbox}
\textbf{ULN2803 ઇન્ટરફેસિંગ:}

\begin{answerdiagram}{ULN2803 Interface}
\begin{tikzpicture}[auto, node distance=1.5cm]
    \node [gtu block, minimum height=2.5cm] (mcu) {ATmega32\\PORTB};
    \node [gtu block, right=of mcu, minimum height=2.5cm] (uln) {ULN2803\\Driver};
    \node [gtu block, right=of uln, minimum height=2cm] (load) {Loads\\(Relay/Motor)};
    
    \draw [gtu arrow] (mcu.20) -- node[above, font=\tiny] {PB0} (uln.160);
    \draw [gtu arrow] (mcu.0) -- node[above, font=\tiny] {PB1} (uln.180);
    \draw [gtu arrow] (mcu.-20) -- node[above, font=\tiny] {PB2} (uln.200);
    
    \draw [gtu arrow] (uln.20) -- node[above, font=\tiny] {OUT1} (load.160);
    \draw [gtu arrow] (uln.0) -- node[above, font=\tiny] {OUT2} (load.180);
    \draw [gtu arrow] (uln.-20) -- node[above, font=\tiny] {OUT3} (load.200);
    
    \node [above=0.5cm of load] (vcc) {+12V};
    \draw [gtu arrow] (vcc) -- (load);
    \draw [gtu arrow] (uln.270) -- ++(0,-0.5) node[below] {GND};
    \draw [gtu arrow] (uln.90) -- ++(0,0.5) node[above] {COM (+12V)};
\end{tikzpicture}
\end{answerdiagram}

\keyword{કનેક્શન્સ:}
\begin{itemize}
    \item \keyword{Inputs}: ATmega32 pins ને સીધા ULN2803 inputs (1B-8B) સાથે connect કરો.
    \item \keyword{Outputs}: Open collector outputs positive supply સાથે જોડાયેલા loads ને drive કરે છે.
    \item \keyword{Common}: Pin 10 ને COM (Load Supply) સાથે (flyback diodes માટે), Pin 9 ને GND સાથે.
\end{itemize}
\end{solutionbox}

\begin{mnemonicbox}
\mnemonic{Input Output Common Supply Ground}
\end{mnemonicbox}

\questionmarks{4(b)}{4}{Port B પરથી ડેટા બાઈટ લેવો અને તેને Port C પર મોકલવા AVR માટેનો C પ્રોગ્રામ લખો.}

\begin{solutionbox}
\textbf{પ્રોગ્રામ:}

\begin{lstlisting}[language=C]
#include <avr/io.h>

int main() {
    // Configure Directions
    DDRB = 0x00;    // Port B Input તરીકે
    DDRC = 0xFF;    // Port C Output તરીકે
    
    // Input Port પર Pull-ups Enable કરો
    PORTB = 0xFF;   
    
    while(1) {
        // PINB register થી data read કરો
        unsigned char data = PINB;
        
        // PORTC register પર data write કરો
        PORTC = data;
    }
    return 0;
}
\end{lstlisting}

\begin{itemize}
    \item \keyword{Direction}: DDRB=0 (In), DDRC=1 (Out).
    \item \keyword{Pull-ups}: DDRB=0 હોય ત્યારે PORTB માં 1 write કરવાથી internal pull-ups enable થાય છે.
    \item \keyword{Transfer}: Continuous loop PINB reads કરે છે અને PORTC updates કરે છે.
\end{itemize}
\end{solutionbox}

\begin{mnemonicbox}
\mnemonic{Configure Enable Read Write}
\end{mnemonicbox}

\questionmarks{4(ક)}{7}{MAX7221 નો ATmega32 સાથે ઇન્ટરફેસિંગ ડાયાગ્રામ દોરો અને સમજાવો.}

\begin{solutionbox}
\textbf{MAX7221 Interface:}

\begin{answerdiagram}{MAX7221 Interface}
\begin{tikzpicture}[auto, node distance=2cm]
    \node [gtu block] (mcu) {ATmega32};
    \node [gtu block, right=of mcu] (max) {MAX7221\\Display Driver};
    \node [gtu block, right=of max, align=center] (disp) {7-Segment\\Display};
    
    \draw [gtu arrow] (mcu.20) -- node[above, font=\tiny] {PB5 (MOSI)} (max.160);
    \draw [gtu arrow] (mcu.0) -- node[above, font=\tiny] {PB7 (SCK)} (max.180);
    \draw [gtu arrow] (mcu.-20) -- node[above, font=\tiny] {PB4 (SS)} (max.200);
    
    \draw [gtu arrow] (max) -- node[above, font=\tiny] {SEG/DIG} (disp);
    
    \node [above=0.3cm of max] (vcc) {VCC};
    \draw [gtu arrow] (vcc) -- (max);
\end{tikzpicture}
\end{answerdiagram}

\keyword{Interface વિગતો:}
\begin{itemize}
    \item \keyword{Protocol}: SPI (Serial Peripheral Interface). 3-wire: Data (DIN), Clock (CLK), Load (CS).
    \item \keyword{Function}: 8 common-cathode 7-segment displays સુધી drive કરે છે.
    \item \keyword{Multiplexing}: Scanning circuitry internally handle કરે છે.
    \item \keyword{Current Control}: External resistor (ISET pin) દ્વારા set થાય છે.
\end{itemize}

\keyword{Programming}:
\begin{enumerate}
    \item LOAD (CS) Low કરો.
    \item CLK rising edge પર DIN દ્વારા 16-bit word (Address + Data) shift in કરો.
    \item Data latch કરવા LOAD High pulse આપો.
\end{enumerate}
\end{solutionbox}

\begin{mnemonicbox}
\mnemonic{SPI Data Clock Load Multiplex Current Program}
\end{mnemonicbox}

\orquestionmarks{4(અ)}{3}{LM35 નો ATmega32 સાથે ઇન્ટરફેસિંગ ડાયાગ્રામ દોરો.}

\begin{solutionbox}
\textbf{LM35 Interface Circuit:}

\begin{answerdiagram}{LM35 Connection}
\begin{tikzpicture}[auto, node distance=2cm]
    \node [gtu block] (lm35) {LM35\\Sensor};
    \node [gtu block, right=of lm35] (mcu) {ATmega32\\(ADC)};
    
    \draw [gtu arrow] (lm35) -- node[midway, above] {Vout} node[midway, below] {(10mV/$^\circ$C)} (mcu);
    
    \node [above=0.5cm of lm35] (vcc) {+5V};
    \node [below=0.5cm of lm35] (gnd) {GND};
    \draw [gtu arrow] (vcc) -- (lm35);
    \draw [gtu arrow] (lm35) -- (gnd);
    
    \node [right=0.1cm of mcu] (adc) {PA0 (ADC0)};
\end{tikzpicture}
\end{answerdiagram}

\keyword{Specifications:}
\begin{itemize}
    \item \keyword{Output}: Temperature ના પ્રમાણમાં Linear voltage ($10\text{mV}/^\circ\text{C}$).
    \item \keyword{Connection}: Vout કોઈપણ ADC channel (e.g., PA0) સાથે connect કરો.
    \item \keyword{Conversion}: $V_{in} \times \frac{1024}{V_{ref}} = \text{ADC Value}$.
\end{itemize}
\end{solutionbox}

\begin{mnemonicbox}
\mnemonic{VCC OUT GND Linear}
\end{mnemonicbox}

\orquestionmarks{4(બ)}{4}{Port C ના બીટ-5 ને મોનીટર કરો, જો તે HIGH હોય તો 55H ને Port B પર મોકલો નહીં તો AAH ને Port B પર મોકલવા AVR માટેનો C પ્રોગ્રામ લખો.}

\begin{solutionbox}
\textbf{પ્રોગ્રામ:}

\begin{lstlisting}[language=C]
#include <avr/io.h>

int main() {
    DDRC &= ~(1<<5);    // PC5 Input તરીકે
    PORTC |= (1<<5);    // PC5 પર Pull-up Enable કરો
    DDRB = 0xFF;        // Port B Output તરીકે
    
    while(1) {
        // PC5 High છે કે નહીં check કરો
        if(PINC & (1<<5)) {
            PORTB = 0x55;   // Pattern 01010101
        } else {
            PORTB = 0xAA;   // Pattern 10101010
        }
    }
    return 0;
}
\end{lstlisting}

\keyword{Logic:}
\begin{itemize}
    \item \keyword{Masking}: \code{PINC \& (1<<5)} bit 5 ને isolate કરે છે.
    \item \keyword{Condition}: જો result non-zero (True) હોય, તો bit High છે.
\end{itemize}
\end{solutionbox}

\begin{mnemonicbox}
\mnemonic{Monitor Conditional Output Loop}
\end{mnemonicbox}

\orquestionmarks{4(ક)}{7}{AVR માં SPI ને પ્રોગ્રામ કરવા માટેના રજિસ્ટરોની ચર્ચા કરો.}

\begin{solutionbox}
\keyword{SPI Registers:}

\begin{answertable}{SPI Registers}
\begin{tabulary}{\linewidth}{|L|L|}
\hline
\textbf{Register} & \textbf{Function} \\ \hline
\keyword{SPCR} & Control Register - EN, Int, Order, Master/Slave, Mode \\ \hline
\keyword{SPSR} & Status Register - Interrupt Flag (SPIF), Collision (WCOL) \\ \hline
\keyword{SPDR} & Data Register - Transmission/Reception માટે Shift register \\ \hline
\end{tabulary}
\end{answertable}

\keyword{SPCR Bits:}
\begin{itemize}
    \item \keyword{SPE}: SPI Enable.
    \item \keyword{MSTR}: Master (1) અથવા Slave (0) Select.
    \item \keyword{SPR1:0}: Clock Rate Select (fosc/4, /16, /64, /128).
    \item \keyword{CPOL/CPHA}: Clock Polarity અને Phase (Mode 0-3).
\end{itemize}

\keyword{ઉપયોગ}: SPDR માં write કરવાથી transmission શરૂ થાય છે (Master). SPIF set થયા પછી SPDR read કરવાથી received data મળે છે.
\end{solutionbox}

\begin{mnemonicbox}
\mnemonic{Control Status Data Configure Enable Write Wait Read}
\end{mnemonicbox}

\questionmarks{5(અ)}{3}{મોટર ડ્રાઇવર આઈસી L293D નો પીન ડાયાગ્રામ દોરો.}

\begin{solutionbox}
\textbf{L293D Pinout:}

\begin{center}
\begin{tikzpicture}[
    pin/.style={draw, rectangle, minimum width=2cm, minimum height=0.5cm, font=\tiny},
    ic/.style={draw, rectangle, minimum width=3cm, minimum height=5cm, fill=gray!10}
]
    \node [ic] (body) {};
    \node [anchor=north, font=\bfseries] at (body.north) {L293D};

    % Pins Left
    \foreach \i/\label in {1/Enable1, 2/Input1, 3/Output1, 4/GND, 5/GND, 6/Output2, 7/Input2, 8/VCC2} {
        \node [anchor=west, font=\tiny] at ([yshift=-0.5cm-\i*0.5cm]body.north west) {\i\ \label};
        \draw ([yshift=-0.5cm-\i*0.5cm]body.north west) -- +(-0.2,0);
    }

    % Pins Right
    \foreach \i/\label in {16/VCC1, 15/Input4, 14/Output4, 13/GND, 12/GND, 11/Output3, 10/Input3, 9/Enable2} {
        \pgfmathsetmacro{\ypos}{17-\i}
        \node [anchor=east, font=\tiny] at ([yshift=-0.5cm-\ypos*0.5cm]body.north east) {\label\ \i};
        \draw ([yshift=-0.5cm-\ypos*0.5cm]body.north east) -- +(0.2,0);
    }
\end{tikzpicture}
\end{center}
\end{solutionbox}

\begin{mnemonicbox}
\mnemonic{Enable Input Output Supply Ground}
\end{mnemonicbox}

\questionmarks{5(બ)}{4}{ADMUX રજિસ્ટર દોરો અને સમજાવો.}

\begin{solutionbox}
\keyword{ADMUX (ADC Multiplexer Selection Register):}

\begin{answertable}{ADMUX Register}
\begin{tabulary}{\linewidth}{|c|c|c|c|c|c|c|c|}
\hline
\textbf{7} & \textbf{6} & \textbf{5} & \textbf{4} & \textbf{3} & \textbf{2} & \textbf{1} & \textbf{0} \\ \hline
REFS1 & REFS0 & ADLAR & MUX4 & MUX3 & MUX2 & MUX1 & MUX0 \\ \hline
\end{tabulary}
\end{answertable}

\keyword{Bit વર્ણન:}
\begin{itemize}
    \item \keyword{REFS1:0}: Reference Selection Bits.
        \begin{itemize}
            \item 00: AREF, Internal Vref turned off.
            \item 01: AREF pin પર external capacitor સાથે AVCC.
            \item 11: Internal 2.56V Voltage Reference.
        \end{itemize}
    \item \keyword{ADLAR}: ADC Left Adjust Result. જો 1 હોય, તો result left-adjusted છે (8-bit precision માટે).
    \item \keyword{MUX4:0}: Analog Channel અને Gain Selection Bits. કઈ ADC pin (ADC0-ADC7) connect કરવી તે select કરે છે.
\end{itemize}
\end{solutionbox}

\begin{mnemonicbox}
\mnemonic{Reference Adjust Multiplex Channel}
\end{mnemonicbox}

\questionmarks{5(ક)}{7}{GSM આધારિત સિક્યુરિટિ સિસ્ટમનો બ્લોક ડાયાગ્રામ સમજાવો.}

\begin{solutionbox}
\textbf{GSM Security System:}

\begin{answerdiagram}{GSM Security Block Diagram}
\begin{tikzpicture}[auto, node distance=2cm]
    \node [gtu block] (mcu) {Microcontroller\\(ATmega32)};
    \node [gtu input, left=of mcu] (sensor) {Sensors\\(PIR/Door)};
    \node [gtu block, right=of mcu] (gsm) {GSM Module\\(SIM900)};
    \node [gtu block, above=of mcu] (lcd) {LCD Display};
    \node [gtu block, below=of mcu] (alarm) {Alarm/Buzzer};
    \node [gtu block, right=of gsm] (network) {Mobile\\Network};
    \node [gtu block, below=of network] (user) {User Phone};

    \draw [gtu arrow] (sensor) -- (mcu);
    \draw [gtu arrow] (mcu) -- (gsm);
    \draw [gtu arrow] (mcu) -- (lcd);
    \draw [gtu arrow] (mcu) -- (alarm);
    \draw [gtu arrow] (gsm) -- (network);
    \draw [gtu arrow] (network) -- (user);
\end{tikzpicture}
\end{answerdiagram}

\keyword{સ્ટેપ્સ:}
\begin{itemize}
    \item \keyword{Sensors}: PIR sensor motion detect કરે છે, Door switches entry detect કરે છે.
    \item \keyword{Microcontroller}: Sensor inputs process કરે છે. જો intrusion detect થાય:
        \begin{enumerate}
            \item Alarm/Buzzer active કરે છે.
            \item GSM Module ને AT commands મોકલે છે.
            \item LCD પર Status update કરે છે.
        \end{enumerate}
    \item \keyword{GSM Module}: Cellular network સાથે UART દ્વારા communicate કરે છે. User ને SMS/Call મોકલે છે.
    \item \keyword{User Mobile}: Alert receive કરે છે ("Intruder Detected!").
\end{itemize}
\end{solutionbox}

\begin{mnemonicbox}
\mnemonic{Sensors Microcontroller GSM Mobile Alarm Display Power Operation}
\end{mnemonicbox}

\orquestionmarks{5(અ)}{3}{મોટર ડ્રાઇવર L293D નો ઉપયોગ કરી ડી.સી. મોટરને ATmega32 સાથે ઇન્ટરફેસ કરવાનો સર્કિટ ડાયાગ્રામ દોરો.}

\begin{solutionbox}
\textbf{DC Motor Interface:}

\begin{answerdiagram}{DC Motor with L293D}
\begin{tikzpicture}[auto, node distance=2cm]
    \node [gtu block] (mcu) {ATmega32};
    \node [gtu block, right=of mcu] (l293) {L293D};
    \node [gtu block, right=of l293] (motor) {DC Motor};
    
    \draw [gtu arrow] (mcu.30) -- node[above, font=\tiny] {PB0(EN)} (l293.150);
    \draw [gtu arrow] (mcu.0) -- node[above, font=\tiny] {PB1(IN1)} (l293.180);
    \draw [gtu arrow] (mcu.-30) -- node[above, font=\tiny] {PB2(IN2)} (l293.210);
    
    \draw [gtu arrow] (l293.30) -- node[above, font=\tiny] {OUT1} (motor.150);
    \draw [gtu arrow] (l293.-30) -- node[above, font=\tiny] {OUT2} (motor.210);
    
    \node [above=0.5cm of l293] (vcc) {VCC (5V/12V)};
    \draw [gtu arrow] (vcc) -- (l293);
\end{tikzpicture}
\end{answerdiagram}

\keyword{Control Logic:}
\begin{itemize}
    \item \keyword{Enable}: Driver channel activate કરવા High (1) આપો.
    \item \keyword{Direction}: IN1=1, IN2=0 (Forward); IN1=0, IN2=1 (Reverse).
    \item \keyword{Stop}: IN1=0, IN2=0.
\end{itemize}
\end{solutionbox}

\begin{mnemonicbox}
\mnemonic{Enable Direction Output Power Control}
\end{mnemonicbox}

\orquestionmarks{5(બ)}{4}{ADCSRA રજિસ્ટર દોરો અને સમજાવો.}

\begin{solutionbox}
\keyword{ADCSRA (ADC Control and Status Register A):}

\begin{answertable}{ADCSRA Register}
\begin{tabulary}{\linewidth}{|c|c|c|c|c|c|c|c|}
\hline
\textbf{7} & \textbf{6} & \textbf{5} & \textbf{4} & \textbf{3} & \textbf{2} & \textbf{1} & \textbf{0} \\ \hline
ADEN & ADSC & ADATE & ADIF & ADIE & ADPS2 & ADPS1 & ADPS0 \\ \hline
\end{tabulary}
\end{answertable}

\keyword{Bit કાર્યો:}
\begin{itemize}
    \item \keyword{ADEN}: ADC Enable. ADC વાપરવા માટે 1 set કરવું આવશ્યક છે.
    \item \keyword{ADSC}: Start Conversion. Single conversion શરૂ કરવા 1 write કરો.
    \item \keyword{ADATE}: Auto Trigger Enable.
    \item \keyword{ADIF}: Interrupt Flag. Conversion પૂરું થાય ત્યારે set થાય છે.
    \item \keyword{ADIE}: Interrupt Enable. જો Global Interrupts enabled હોય તો ADC interrupt activate કરે છે.
    \item \keyword{ADPS2:0}: Prescaler Select. System clock ને divide કરે છે (e.g., 8MHz crystal માટે /128) જેથી ADC clock (50-200kHz) મળે.
\end{itemize}
\end{solutionbox}

\begin{mnemonicbox}
\mnemonic{Enable Start Auto Interrupt Prescaler Configure}
\end{mnemonicbox}

\end{document}
